<link rel="stylesheet" href="/css/dashboard.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>üìù <%= contratoId ? 'Editar' : 'Novo' %> Contrato</h2>
        <a href="/contratos" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Voltar
        </a>
    </div>

    <form id="form-contrato">
        <!-- Dados B√°sicos -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">1. Dados B√°sicos</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Cliente *</label>
                        <select id="cliente_id" name="cliente_id" class="form-select" required>
                            <option value="">Selecione um cliente</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Ve√≠culo *</label>
                        <select id="veiculo_placa" name="veiculo_placa" class="form-select" required>
                            <option value="">Selecione um ve√≠culo</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Data de Assinatura</label>
                        <input type="date" name="data_assinatura" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Data de In√≠cio *</label>
                        <input type="date" name="data_inicio" class="form-control" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Vig√™ncia (dias)</label>
                        <input type="number" name="vigencia_dias" class="form-control" value="30">
                    </div>
                </div>
            </div>
        </div>

        <!-- Condi√ß√µes Contratuais -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">2. Condi√ß√µes Contratuais</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Dia de Pagamento</label>
                        <select name="dia_pagamento" class="form-select">
                            <option value="segunda-feira">Segunda-feira</option>
                            <option value="terca-feira">Ter√ßa-feira</option>
                            <option value="quarta-feira">Quarta-feira</option>
                            <option value="quinta-feira">Quinta-feira</option>
                            <option value="sexta-feira">Sexta-feira</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">KM Franquia</label>
                        <input type="number" name="km_franquia" class="form-control" value="100">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Valor KM Excedente (R$)</label>
                        <input type="number" step="0.01" name="valor_km_excedente" class="form-control" value="0.50">
                    </div>
                </div>
            </div>
        </div>

        <!-- Cau√ß√£o -->
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">3. Cau√ß√£o</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Valor da Cau√ß√£o (R$)</label>
                        <input type="number" step="0.01" name="valor_caucao" id="valor_caucao" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Forma de Pagamento</label>
                        <select name="caucao_forma_pagamento" id="caucao_forma_pagamento" class="form-select">
                            <option value="a_vista">√Ä Vista</option>
                            <option value="parcelada">Parcelada</option>
                        </select>
                    </div>
                    <div class="col-md-4" id="div-parcelas" style="display:none;">
                        <label class="form-label">N√∫mero de Parcelas</label>
                        <input type="number" name="caucao_num_parcelas" id="caucao_num_parcelas" class="form-control"
                            min="1" max="12">
                    </div>
                </div>
            </div>
        </div>

        <!-- Itens do Contrato -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">4. Itens do Contrato</h5>
            </div>
            <div class="card-body">
                <button type="button" id="btn-adicionar-item" class="btn btn-sm btn-success mb-3">
                    <i class="bi bi-plus"></i> Adicionar Item
                </button>
                <table class="table table-sm" id="tabela-itens">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Quantidade</th>
                            <th>Valor Unit.</th>
                            <th>Total</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Itens adicionados dinamicamente -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="3" class="text-end">TOTAL:</th>
                            <th id="total-itens">R$ 0,00</th>
                            <th></th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- Bot√µes -->
        <div class="text-end">
            <button type="button" class="btn btn-secondary" onclick="window.location='/contratos'">
                Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Salvar Contrato
            </button>
        </div>
    </form>
</div>

<!-- Modal para adicionar item -->
<div class="modal fade" id="modal-item" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Adicionar Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Item Padr√£o</label>
                    <select id="item-padrao" class="form-select">
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Quantidade</label>
                    <input type="number" id="item-quantidade" class="form-control" value="1" min="1">
                </div>
                <div class="mb-3">
                    <label class="form-label">Valor Unit√°rio</label>
                    <input type="number" step="0.01" id="item-valor" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btn-confirmar-item">Adicionar</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/contrato-form.js"></script>